<!DOCTYPE html>
<html>
<head>
  <title>PlacementPro â€“ Integrated Campus Career Suite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    * { box-sizing: border-box; transition: 0.3s ease; }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1e3a8a, #2563eb);
      color: white;
    }

    .dark { background: #0f172a; }

    .navbar {
      display: flex;
      justify-content: space-between;
      padding: 20px 50px;
      align-items: center;
    }

    .logo { font-size: 22px; font-weight: bold; }

    .badge {
      background: #10b981;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      margin-left: 10px;
    }

    .nav-right button {
      margin-left: 10px;
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    .btn-white { background: white; color: #2563eb; }
    .btn-glass { background: rgba(255,255,255,0.2); color: white; }

    .hero {
      text-align: center;
      padding: 20px;
    }

    .main {
      display: flex;
      justify-content: center;
      gap: 25px;
      flex-wrap: wrap;
      padding: 20px;
    }

    .card {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 12px;
      width: 320px;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 6px;
      border: none;
    }

    button.action {
      width: 100%;
      padding: 10px;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    .stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px;
    }

    .box {
      background: rgba(255,255,255,0.2);
      padding: 15px;
      border-radius: 10px;
      width: 120px;
      text-align: center;
    }

    .box p { font-size: 20px; font-weight: bold; }

    #results { max-width: 700px; margin: 20px auto; }

    .student {
      background: rgba(255,255,255,0.1);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .status {
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
    }

    .applied { background: orange; }
    .aptitude { background: #3b82f6; }
    .selected { background: #10b981; }

    .loader {
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin { 100% { transform: rotate(360deg); } }

    .chatbox {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 280px;
      background: white;
      color: black;
      border-radius: 10px;
      padding: 10px;
    }

    .chatbox button {
      width: 100%;
      background: #2563eb;
      color: white;
      border: none;
      padding: 6px;
      border-radius: 6px;
      margin-top: 5px;
    }

  </style>
</head>

<body>

<div class="navbar">
  <div>
    <span class="logo">PlacementPro</span>
    <span class="badge">AI Powered</span>
  </div>

  <div class="nav-right">
    <button class="btn-glass" onclick="roleLogin()">Login</button>
    <button class="btn-white" onclick="toggleTheme()">ðŸŒ™</button>
  </div>
</div>

<div class="hero">
  <h2>Integrated Campus Career Suite</h2>
  <p>Role-Based Placement Automation & AI Intelligence</p>
</div>

<div class="main">

  <div class="card">
    <h3>Criteria Engine â€“ Create Drive</h3>
    <input id="driveName" placeholder="Company Name">
    <input id="minCgpa" placeholder="Minimum CGPA">
    <input id="allowedBranch" placeholder="Allowed Branch">
    <button class="action" onclick="createDrive()">Create Drive</button>
    <p id="driveResult"></p>
  </div>

  <div class="card">
    <h3>Resume Wizard & Skill Gap</h3>
    <textarea id="resume" rows="5" placeholder="Paste resume skills..."></textarea>
    <button class="action" onclick="scoreResume()">Analyze Resume</button>
    <p id="score"></p>
    <p id="suggestion"></p>
  </div>

</div>

<div class="stats">
  <div class="box"><h4>Total</h4><p id="total">0</p></div>
  <div class="box"><h4>Eligible</h4><p id="eligible">0</p></div>
  <div class="box"><h4>Not Eligible</h4><p id="notEligible">0</p></div>
</div>

<div id="results"></div>

<div class="chatbox">
  <b>PlacementBot</b>
  <div id="chat"></div>
  <input id="msg" placeholder="Ask about cutoff, interview...">
  <button onclick="sendMsg()">Send</button>
</div>

<script>

const BASE_URL = "https://placementpro-49u8.onrender.com";

function toggleTheme() {
  document.body.classList.toggle("dark");
}

function roleLogin() {
  const role = prompt("Enter Role: TPO / Student / Alumni");

  if (!role) return;

  alert("Logged in as " + role.toUpperCase());
}

function animateValue(id, end) {
  let start = 0;
  let obj = document.getElementById(id);
  let timer = setInterval(() => {
    start++;
    obj.innerText = start;
    if (start >= end) clearInterval(timer);
  }, 20);
}

function createDrive() {
  const name = document.getElementById("driveName").value;
  document.getElementById("driveResult").innerText =
    name + " Drive Created. 142 Students Eligible.";
}

async function scoreResume() {
  const text = document.getElementById("resume").value;

  const res = await fetch(`${BASE_URL}/ai-score`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({resumeText: text})
  });

  const data = await res.json();

  document.getElementById("score").innerText =
    "Score: " + data.score + "/100";

  document.getElementById("suggestion").innerText =
    text.includes("Power BI")
      ? "You match Data Analyst market demand."
      : "Skill Gap: Learn Power BI (80% placed students had it).";
}

async function sendMsg() {
  const msg = document.getElementById("msg").value;

  const res = await fetch(`${BASE_URL}/chat`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({message: msg})
  });

  const data = await res.json();

  document.getElementById("chat").innerHTML +=
    `<div><b>You:</b> ${msg}</div>
     <div><b>Bot:</b> ${data.reply}</div>`;

  document.getElementById("msg").value = "";
}

async function loadDashboard() {
  document.getElementById("results").innerHTML = "<div class='loader'></div>";

  const res = await fetch(`${BASE_URL}/students`);
  const data = await res.json();

  let results = document.getElementById("results");
  results.innerHTML = "<h3>Application Tracker</h3>";

  data.forEach((s, i) => {
    let statusClass = i % 3 === 0 ? "applied" :
                      i % 3 === 1 ? "aptitude" : "selected";

    results.innerHTML += `
      <div class="student">
        <b>${s.name}</b> â€“ CGPA: ${s.cgpa}
        <br>Status:
        <span class="status ${statusClass}">
          ${statusClass.toUpperCase()}
        </span>
      </div>
    `;
  });

  animateValue("total", data.length + 3);
  animateValue("eligible", data.length);
  animateValue("notEligible", 3);
}

</script>

</body>
</html>