<!DOCTYPE html>
<html>
<head>
  <title>PlacementPro – Integrated Campus Career Suite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

    body {
      margin: 0;
      background: linear-gradient(135deg,#1e3a8a,#2563eb);
      color: white;
    }

    .navbar {
      display:flex;
      justify-content:space-between;
      padding:15px 40px;
      background:rgba(0,0,0,0.2);
    }

    .logo { font-weight:bold; font-size:20px; }

    button {
      padding:8px 12px;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-weight:bold;
    }

    .btn-primary { background:#10b981; color:white; }
    .btn-white { background:white; color:#2563eb; }

    .section {
      margin:20px;
      padding:20px;
      background:rgba(255,255,255,0.1);
      border-radius:12px;
    }

    input, textarea, select {
      width:100%;
      padding:8px;
      margin:6px 0;
      border-radius:6px;
      border:none;
    }

    .grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
      gap:20px;
    }

    .student {
      background:rgba(255,255,255,0.15);
      padding:10px;
      margin-top:10px;
      border-radius:8px;
    }

    .status {
      padding:4px 8px;
      border-radius:10px;
      font-size:12px;
      font-weight:bold;
    }

    .applied { background:orange; }
    .aptitude { background:#3b82f6; }
    .cleared { background:#9333ea; }
    .selected { background:#10b981; }

    .chatbox {
      position:fixed;
      bottom:20px;
      right:20px;
      width:280px;
      background:white;
      color:black;
      border-radius:10px;
      padding:10px;
    }

    .chatbox button {
      width:100%;
      background:#2563eb;
      color:white;
      margin-top:5px;
    }

  </style>
</head>

<body>

<div class="navbar">
  <div class="logo">PlacementPro AI</div>
  <button class="btn-white" onclick="loadDashboard()">Admin Dashboard</button>
</div>

<!-- ================= TPO CRITERIA ENGINE ================= -->

<div class="section">
  <h2>TPO – Criteria Engine (Create Drive)</h2>
  <div class="grid">
    <div>
      <input id="cgpa" placeholder="Minimum CGPA">
      <input id="branch" placeholder="Allowed Branch">
      <input id="backlogs" placeholder="Maximum Backlogs">
      <button class="btn-primary" onclick="runEligibility()">Find Eligible</button>
      <p id="eligibleCount"></p>
    </div>
  </div>
  <div id="eligibleResults"></div>
</div>

<!-- ================= STUDENT RESUME WIZARD ================= -->

<div class="section">
  <h2>Student – Resume Wizard & Skill Gap</h2>
  <textarea id="resume" rows="4" placeholder="Paste your skills & projects..."></textarea>
  <button class="btn-primary" onclick="scoreResume()">Generate Resume Score</button>
  <p id="score"></p>
  <p id="skillGap"></p>
</div>

<!-- ================= ALUMNI CONNECT ================= -->

<div class="section">
  <h2>Alumni Connect – Referral Board</h2>
  <input id="jobPost" placeholder="Post Job Opening (e.g., Data Analyst at Infosys)">
  <button class="btn-primary" onclick="postJob()">Post</button>
  <div id="jobBoard"></div>
</div>

<div class="section">
  <h2>Mentorship Slots</h2>
  <input id="mentorName" placeholder="Alumni Name">
  <input id="mentorTime" placeholder="Available Hours">
  <button class="btn-primary" onclick="addMentor()">Add Slot</button>
  <div id="mentorBoard"></div>
</div>

<!-- ================= APPLICATION TRACKER ================= -->

<div class="section">
  <h2>Application Tracker</h2>
  <div id="tracker"></div>
</div>

<!-- ================= PLACEMENT BOT ================= -->

<div class="chatbox">
  <b>PlacementBot</b>
  <div id="chat"></div>
  <input id="msg" placeholder="Ask cutoff, interview...">
  <button onclick="sendMsg()">Send</button>
</div>

<script>

const BASE_URL = "https://placementpro-49u8.onrender.com";

/* ================= CRITERIA ENGINE ================= */

async function runEligibility() {
  const cgpa = document.getElementById("cgpa").value;
  const branch = document.getElementById("branch").value;
  const backlogs = document.getElementById("backlogs").value;

  const res = await fetch(`${BASE_URL}/eligible?cgpa=${cgpa}&branch=${branch}&backlogs=${backlogs}`);
  const data = await res.json();

  document.getElementById("eligibleCount").innerText =
    data.length + " Students Eligible";

  let output = "";
  data.forEach(s => {
    output += `<div class="student"><b>${s.name}</b> | CGPA: ${s.cgpa}</div>`;
  });

  document.getElementById("eligibleResults").innerHTML = output;
}

/* ================= RESUME WIZARD ================= */

async function scoreResume() {
  const text = document.getElementById("resume").value;

  const res = await fetch(`${BASE_URL}/ai-score`, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({resumeText:text})
  });

  const data = await res.json();

  document.getElementById("score").innerText =
    "Resume Score: " + data.score + "/100";

  if (!text.toLowerCase().includes("powerbi")) {
    document.getElementById("skillGap").innerText =
      "Skill Gap: 80% of placed Data Analysts had Power BI. Recommended learning path.";
  } else {
    document.getElementById("skillGap").innerText =
      "You match current market demand.";
  }
}

/* ================= ADMIN DASHBOARD ================= */

async function loadDashboard() {
  const res = await fetch(`${BASE_URL}/students`);
  const data = await res.json();

  let html = "";
  data.forEach((s,i)=>{
    let status = ["applied","aptitude","cleared","selected"][i%4];
    html += `
      <div class="student">
        ${s.name} – CGPA: ${s.cgpa}
        <span class="status ${status}">${status.toUpperCase()}</span>
      </div>
    `;
  });

  document.getElementById("tracker").innerHTML = html;
}

/* ================= ALUMNI ================= */

function postJob() {
  const job = document.getElementById("jobPost").value;
  document.getElementById("jobBoard").innerHTML +=
    `<div class="student">${job}</div>`;
}

function addMentor() {
  const name = document.getElementById("mentorName").value;
  const time = document.getElementById("mentorTime").value;

  document.getElementById("mentorBoard").innerHTML +=
    `<div class="student">${name} – Available: ${time}</div>`;
}

/* ================= CHATBOT ================= */

async function sendMsg() {
  const msg = document.getElementById("msg").value;

  const res = await fetch(`${BASE_URL}/chat`, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:msg})
  });

  const data = await res.json();

  document.getElementById("chat").innerHTML +=
    `<div><b>You:</b> ${msg}</div>
     <div><b>Bot:</b> ${data.reply}</div>`;

  document.getElementById("msg").value="";
}

</script>

</body>
</html>